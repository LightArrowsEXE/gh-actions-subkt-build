name: 'SubKt Builder'
description: 'Auto-build SubKt projects'
author: 'LightArrowsEXE'

inputs:
  mux-task:
    description: 'The muxing task to execute the dependencies of. If empty, no dependency resolution will be performed'
    required: false
    default: 'mux'
  incremental:
    description: 'Only build episodes with changes (only used if mux-task is specified)'
    required: false
    default: 'false'

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - uses: actions/setup-java@v4
      with:
        java-version: '16'
        distribution: 'temurin'

    - name: Run Gradle Dependencies
      shell: bash
      working-directory: ${{ github.workspace }}
      run: |
        chmod +x ./gradlew
        if [ -n "${{ inputs.mux-task }}" ]; then
          echo "Getting dependencies for mux task: ${{ inputs.mux-task }}"
          DEPS=$(./gradlew :dependencies --configuration ${{ inputs.mux-task }} --quiet)
          if [ -n "$DEPS" ]; then
            echo "Running dependencies: $DEPS"
            ./gradlew $DEPS
          else
            echo "No dependencies found for mux task"
            exit 1
          fi
        else
          echo "No mux task specified"
          exit 1
        fi

    - name: Upload Build Artifacts
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: build-artifacts
        path: |
          build/**/*
          !build/tmp/**
          !build/.gradle/**
        if-no-files-found: error
